---
title: なんでか突然Protocol Buffers
date: 2015-01-13 00:28:33
tags: protobuf_bvgsdk, 
---
Protocol Buffersってのは<a href="https://developers.google.com/protocol-buffers/?hl=ja" title="Google Developers: Protocol Buffers" target="_blank">コレねコレ</a>。データシリアライゼーションフォーマットですな。

簡単に言うと、データ構造の定義ファイルを書くと、通信のパケットフォーマットと、そのシリアライズ・デシリアライズのコードが自動生成されるっつーツール＆データフォーマットでござんす。

なんかGoogleの内部の通信に使われてるっぽいんですけど、具体的にはよくわからん。

まあ、別になんかのWebサービスに使いたいわけじゃないんですよ。

ファイルに書き込むデータフォーマットに使いたいんですね。

そもそもの始まりは、bchanがウィンドウ位置覚えないってところです。

なんで覚えないかっちゅーと、<span style="font-size:x-large">めんどくさいから(笑)</span>

……いや、違うんですよ。

えーとね、ウィンドウ位置とか覚えさせるのは仮身や付箋の固有データ領域なんですけど、まあアプリケーションごとに任意のデータが書き込めるわけですよ。

任意のデータっちゅーことは、自分でデータ構造考えないといけないんですけど、開発途中に適当に決めると、あとで変えたくなった時に困るし。

バージョン番号くっつければある程度解決するけど、それはそれで面倒っちゅーか。

面倒なことはソースコード自動生成ツール作って、解決するかー、というわけでね。

まあ、それはそれで面倒ってだったりするんですが。そこで丁度よさそうなProtocol Buffersを使えばいいかなー、と。

定義ファイル書くと、データ構造とシリアライズ・デシリアライズ処理を自動的に生成してくれるっちゅーわけで、この問題を解決するのに丁度よさそうでね。

仕様変更についても、フィールドごとに番号を割り当てられるようになってて、使わなくなったフィールドはその番号を使わないようにすれば解決するようになってます。

<span style="font-size:x-large">というわけで超漢字用に実装しよう。</span>

いや、まあGoogle自身が生成ツール提供してるんですけど、C++とJavaとPythonしか対応してないんですよ。

私が主に使ってるのはCですし。

ってか、そもそも、生成してくれるロジックが、そのまま超漢字開発環境でビルド通るかっちゅーと、ねえ。

そのへんいろいろ考えると、自分で作ったほうがよさそうかなー？　ってわけですね。

まあ、類似のものにASN.1とかありますが。こっちの方はITU-Tが策定したフォーマットだから良さそうではあるんですが。実装の難易度からProtocol Buffersの方に。

ほかにもjson,yaml,xmlとかありますけど、c言語の構造体メンバーとの対応関係とかを記述する方法が無くてねえ。自分で考えるも面倒だし。

んじゃあ、Protocol Buffersかなあ？　と。

そんなわけで、とりあえず<a href="http://sourceforge.jp/users/ornse01/pf/protobuf_bvgsdk/wiki/FrontPage" title="SourceForge.JP 作業部屋：protobuf_bvgsdk" target="_blank">作業部屋</a>作ってみました。