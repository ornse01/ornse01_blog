---
title: amd64なdebianで超漢字開発環境
date: 2014-12-30 02:09:46
tags: btron, 
---
最近ね、新しいPCを買ったのですよ。

んでまあ64bitマシンなわけです。まあ、せっかくだし？

まあ、amd64ならx86の命令セットと互換性があるわけだし、まあ超漢字開発環境もサクっと動かせるだろうと、楽観してたのですよ。

そして、当然のようにDebianのjessieをインストールし、開発環境を構築したわけです。

開発者サイトからダウンロードして、ファイルを展開して、環境変数を設定して、いざんサンプルソースをmake!!

<span style="font-size:large">動かねえ……</span>

ちゅーわけで、試行錯誤した結果どす。

<dl><dt>まずは超漢字開発環境のインストール</dt>
<dd>とりあえずは、<a href="http://www.chokanji.com/developer/index.html" title="超漢字開発者サイト" target="_blank">開発者サイト</a>の手順にしたがってファイルを展開しましょう。

このプラットフォーム依存部分にgccやらなんやらの実行ファイルが含まれているわけですけど、linux版のがx86の32bitバイナリなんですよね。

こいつをDebian amd64環境で動かすわけです。</dd>
<dt>Multiarchの設定</dt>
<dd>んで<a href="https://wiki.debian.org/Multiarch" title="Debian wiki: Multiarch" target="_blank">Multiarch</a>です。

Debianで、別アーキテクチャのバイナリとかパッケージを動かすための仕組みですね。

例えば、amd64上でi386のバイナリとか。試してないがarmのバイナリ動かせたりもするっぽい？

とりあえず、パッケージの設定です。
[shell]
% dpkg --add-architecture i386

% apt-get update
[/shell]
root権限で、こんな感じのコマンドを打ちます。
</dd>
<dt>libc6のインストール</dt>
<dd>まあ普通にDebianをインストールすりゃ入ってるとは思うんだけど。今回入れるのは、i386用のlibc6です。

[shell]
% apt-get install libc6:i386
[/shell]

まあ普通にパッケージインストールするのと変わらんのだけど、後ろに<code>:i386</code>ってつけるのがミソですな。

それをくっつけると、i386用のパッケージがインストールされます。</dd>
<dt>サンプルのビルド</dt>
<dd>あとは超漢字開発環境についてるサンプルをビルドしてみましょう。</dd></dl>

ちゅーわけで、やり方さえ分かればなんてこたないですな。

ポイントはこいつ、
<pre>/lib/ld-linux.so.2</pre>
ってファイル。

こいつが32bitバイナリのプログラムローダーなわけで、こいつが無ければ実行ファイルを走らせられないわけですね。厳密にはシンボリックリンクで、実際のファイルは別のところにあるけど。

んで、これをインストールするのが、libc6:i386 パッケージなんですな。だからこのパッケージをインストールするためにあーだこーだというわけです。

他のlinuxディストリビューションでも同じような話になるとは思うんですけどね、具体的にどうなるのかは調べてまへん。

あと今回のはDebianでもjessieの話ね。testingですよ(2014/12/30現在)。Multiarchは割と新しい仕組みっぽいけど、wheezy以前でどうなのかはよくわかってません。

ところで、これを調べてる途中で、このMultiarchの仕組みの中に、クロスコンパイルをサポートする云々とかあったのよねー。

超漢字開発環境もその仕組みに乗っかってパッケージ化できればいろいろ便利だとは思うわけで、実際できるのかどうか、またそのうち調べてみたいと思います。